language: java
jdk: oraclejdk8

script:
  # set up Hadoop
  - export HADOOP_VERSION=2.7.2
  - HADOOP_ARCHIVE=$HOME/hadoop-$HADOOP_VERSION.tar.gz
  - wget --no-verbose --output-document $HADOOP_ARCHIVE https://github.com/robert-schmidtke/hadoop/releases/download/release-$HADOOP_VERSION-nodeprecatedfilestatus/hadoop-$HADOOP_VERSION.tar.gz
  - tar --extract --file $HADOOP_ARCHIVE --directory $HOME
  - export HADOOP_HOME=$HOME/hadoop-$HADOOP_VERSION
  - rm $HADOOP_ARCHIVE

  # accept own key to start services locally via ssh
  - mkdir -p $HOME/.ssh
  - ssh-keygen -t dsa -P '' -f $HOME/.ssh/id_dsa
  - cat $HOME/.ssh/id_dsa.pub >> $HOME/.ssh/authorized_keys
  - chmod 600 $HOME/.ssh/authorized_keys
  - ssh-keyscan -t dsa localhost >> $HOME/.ssh/known_hosts
  - ssh-keyscan -t dsa 0.0.0.0 >> $HOME/.ssh/known_hosts

  # build the adapter
  - mvn package --define hadoop.version=$HADOOP_VERSION

  # configure Hadoop and run the grep job
  - ./hadoop_grep.sh
